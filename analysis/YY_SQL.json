{"paragraphs":[{"text":"%pyspark\nimport pandas as pd\nimport time\nfrom pyspark.sql.functions import col\nfrom pyspark.sql.functions import monotonically_increasing_id,row_number\nfrom pyspark.sql import Window","user":"anonymous","dateUpdated":"2019-06-15T21:49:53+0900","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1560593479187_723079704","id":"20190610-233446_280670789","dateCreated":"2019-06-15T19:11:19+0900","dateStarted":"2019-06-15T21:49:53+0900","dateFinished":"2019-06-15T21:49:53+0900","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:14498"},{"text":"%pyspark\n#UJ df 구성\n\ndf_chicken_2019 = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\",\"false\").load(\"data/chicken/chicken_2019.csv\")\ndf_chicken_2019=df_chicken_2019.drop(\"_c6\")\ndf_chicken_2019 = df_chicken_2019.select(col(\"_c0\").alias(\"Dates\"), col(\"_c1\").alias(\"Day\"),col(\"_c2\").alias(\"Gender\"),\n                  col(\"_c3\").alias(\"Age\"),col(\"_c4\").alias(\"Si\"), col(\"_c5\").alias(\"Gu\"),\n                   col(\"_c7\").alias(\"Store\"),col(\"_c8\").cast('float').alias(\"Order\"))\ndf_chicken_2019 = df_chicken_2019.drop(\"Si\").drop(\"Store\").drop(\"Day\").drop(\"Gender\").drop(\"Age\")\n\ndf_china_2019 = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\",\"false\").load(\"data/china/china_2019.csv\")\ndf_china_2019 = df_china_2019.drop(\"_c6\")\ndf_china_2019 = df_china_2019.select(col(\"_c0\").alias(\"Dates\"), col(\"_c1\").alias(\"Day\"),col(\"_c2\").alias(\"Gender\"),\n                  col(\"_c3\").alias(\"Age\"),col(\"_c4\").alias(\"Si\"), col(\"_c5\").alias(\"Gu\"),\n                   col(\"_c7\").alias(\"Store\"),col(\"_c8\").cast('float').alias(\"Order\"))\ndf_china_2019 = df_china_2019.drop(\"Si\").drop(\"Store\").drop(\"Day\").drop(\"Gender\").drop(\"Age\")\n\ndf_pizza_2019 = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\",\"false\").load(\"data/pizza/pizza_2019.csv\")\ndf_pizza_2019 = df_pizza_2019.select(col(\"_c0\").alias(\"Dates\"), col(\"_c1\").alias(\"Day\"),col(\"_c2\").alias(\"Gender\"),\n                  col(\"_c3\").alias(\"Age\"),col(\"_c4\").alias(\"Si\"), col(\"_c5\").alias(\"Gu\"),\n                   col(\"_c6\").alias(\"Store\"),col(\"_c7\").cast('float').alias(\"Order\"))\n\ndf_pizza_2019 = df_pizza_2019.drop(\"Si\").drop(\"Store\").drop(\"Day\").drop(\"Gender\").drop(\"Age\")\n\ndf_store_region = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\",\"false\").load(\"data/store/store_region.csv\")\ndf_store_region = df_store_region.select(col(\"_c0\").alias(\"id\"), col(\"_c1\").alias(\"store_type\"),col(\"_c2\").alias(\"Gu\"))\ndf_store_region = df_store_region.replace('중국음식/중국집', 'china')\ndf_store_region = df_store_region.replace('피자전문', 'pizza')\ndf_store_region = df_store_region.replace('후라이드/양념치킨', 'chicken')\ndf_store_region.show(10)\n\ndf_out = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\",\"true\").load(\"data/out.csv\")\n\n#UJ df 구성 끝","user":"anonymous","dateUpdated":"2019-06-16T16:35:47+0900","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1560602993.87\n+----------+----------+----+\n|        id|store_type|  Gu|\n+----------+----------+----+\n|20035727.0|     china| 동작구|\n|20020932.0|     china| 성동구|\n|20335258.0|     pizza| 강동구|\n|23446268.0|     china| 강남구|\n|25354154.0|     china| 송파구|\n|25259932.0|     china|동대문구|\n|25489266.0|   chicken| 강서구|\n|25320078.0|     china|동대문구|\n|25340646.0|     china| 강서구|\n|25582475.0|     pizza| 양천구|\n+----------+----------+----+\nonly showing top 10 rows\n\n1.03570795059\n"}]},"apps":[],"jobName":"paragraph_1560593479188_598639432","id":"20190615-155407_41107975","dateCreated":"2019-06-15T19:11:19+0900","dateStarted":"2019-06-15T21:49:53+0900","dateFinished":"2019-06-15T21:49:54+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:14499"},{"title":"업종 선택","text":"%pyspark\nstore_type=z.select(\"store_type\", [(\"pizza\",\"pizza\"),\n                    (\"chicken\",\"chicken\"),\n                    (\"china\",\"chinese_food\"),\n                    ])\nz.put(\"yy_input_store_type\",store_type)\n\nyy_input_store_type =z.get(\"yy_input_store_type\")\nyy_input_store_type=str(yy_input_store_type)","user":"anonymous","dateUpdated":"2019-06-16T16:35:12+0900","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"runOnSelectionChange":true,"results":{},"enabled":true},"settings":{"params":{"store_type":"pizza"},"forms":{"store_type":{"type":"Select","options":[{"value":"pizza","displayName":"pizza","$$hashKey":"object:14605"},{"value":"chicken","displayName":"chicken","$$hashKey":"object:14606"},{"value":"china","displayName":"chinese_food","$$hashKey":"object:14607"}],"name":"store_type","displayName":"store_type","defaultValue":"","hidden":false,"$$hashKey":"object:14593"}}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1560593479189_641762276","id":"20190615-163526_739017668","dateCreated":"2019-06-15T19:11:19+0900","dateStarted":"2019-06-15T21:49:54+0900","dateFinished":"2019-06-15T21:49:55+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:14500"},{"text":"%pyspark\n#UJ query 구성\n\ndf_chicken_2019.registerTempTable(\"df_chicken\")\ndf_pizza_2019.registerTempTable(\"df_pizza\")\ndf_china_2019.registerTempTable(\"df_china\")\ndf_store_region.registerTempTable(\"df_store\")\n\nquery=\"select Gu, sum(Order) as sum_order from df_\"+yy_input_store_type+\" where Dates>=20190301 group by Gu\"\norder_result=sqlContext.sql(query)\norder_result.registerTempTable(\"order_result\")\n\nquery=\"select Gu, store_type, count(Gu) as sum_store  from df_store group by store_type, Gu order by Gu\"\nstore_result=sqlContext.sql(query)\nstore_result.registerTempTable(\"store_result\")\n\nquery=\"select * from order_result natural join store_result\"\njoin_result_temp=sqlContext.sql(query)\njoin_result_temp.registerTempTable(\"join_result_temp\")\nquery=\"select * from join_result_temp where store_type='\"+yy_input_store_type+\"'\"\njoin_result=sqlContext.sql(query)\njoin_result.registerTempTable(\"join_result\")\n\nquery=\"select Gu, sum_order/sum_store as density from join_result where store_type='\"+yy_input_store_type+\"'\"\ndensity_result=sqlContext.sql(query)\ndensity_result.registerTempTable(\"density_result\")\n\ndf_out.registerTempTable(\"df_out\")\n\nquery=\"select Gu, Eng_Gu, x, y from df_out\"\nout_result=sqlContext.sql(query)\nout_result.registerTempTable(\"out_result\")\n\nquery=\"select * from density_result natural join out_result\"\nfinale_result=sqlContext.sql(query)\nfinale_result.registerTempTable(\"finale_result\")\n\n#UJ query 구성 끝","user":"anonymous","dateUpdated":"2019-06-16T16:36:26+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1560602995.16\n0.134809017181\n"}]},"apps":[],"jobName":"paragraph_1560595882702_1561238714","id":"20190615-195122_1190455976","dateCreated":"2019-06-15T19:51:22+0900","dateStarted":"2019-06-15T21:49:55+0900","dateFinished":"2019-06-15T21:49:55+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:14501"},{"text":"%sql\nselect * from finale_result","user":"anonymous","dateUpdated":"2019-06-15T21:49:55+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Gu":"string","density":"string","Eng_Gu":"string","x":"string","y":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"Gu\tdensity\tEng_Gu\tx\ty\n송파구\t72.58620689655173\tSP\t6\t4\n도봉구\t25.952380952380953\tDB\t5\t1\n은평구\t81.6984126984127\tEP\t2\t2\n양천구\t28.677419354838708\tYC\t1\t4\n중랑구\t106.97872340425532\tJY\t6\t2\n강동구\t103.53623188405797\tGD\t7\t3\n용산구\t59.516129032258064\tYS\t4\t4\n구로구\t107.1774193548387\tGR\t2\t5\n마포구\t86.87931034482759\tMP\t2\t3\n강서구\t175.58333333333334\tGS\t1\t3\n강남구\t73.65040650406505\tGN\t5\t4\n광진구\t25.360655737704917\tGJ\t6\t3\n성동구\t176.8181818181818\tSD\t5\t3\n관악구\t26.95\tGA\t4\t5\n영등포구\t80.6231884057971\tYDP\t2\t4\n동대문구\t133.6122448979592\tDDM\t5\t2\n동작구\t165.37878787878788\tDJ\t3\t4\n중구\t148.3653846153846\tJO\t4\t3\n종로구\t52.729166666666664\tJR\t3\t2\n노원구\t82.5909090909091\tNW\t6\t1\n서대문구\t162.72\tSDM\t3\t3\n금천구\t69.875\tGC\t3\t5\n성북구\t57.9078947368421\tSB\t4\t2\n강북구\t171.24528301886792\tGB\t4\t1\n서초구\t99.98571428571428\tSC\t5\t5\n"}]},"apps":[],"jobName":"paragraph_1560600997942_2068803167","id":"20190615-211637_454345657","dateCreated":"2019-06-15T21:16:37+0900","dateStarted":"2019-06-15T21:49:55+0900","dateFinished":"2019-06-15T21:50:00+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:14502"},{"text":"%sql\n","user":"anonymous","dateUpdated":"2019-06-15T21:49:55+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560602995348_1505941172","id":"20190615-214955_1357388555","dateCreated":"2019-06-15T21:49:55+0900","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:14503"}],"name":"YY_SQL","id":"2ED6HE7ZW","noteParams":{},"noteForms":{},"angularObjects":{"angular:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}